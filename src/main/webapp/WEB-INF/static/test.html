<!DOCTYPE html>
<html>
<head>
  <style>
    /* Set the size of the div element that contains the map */
    #map {
      height: 400px; /* The height is 400 pixels */
      width: 100%; /* The width is the width of the web page */
      z-index: 1;
    }
 
  </style>
  <script type="text/javascript" src="jquery-3.4.1.js"></script>
</head>
<body>
<h3>Look at my Googles</h3>
<div id="form">
  <p>Маркер</p>
  <form id="formId" class="form-horizontal save-form" style="display: none">
			<h1>Add me!</h1>
				<div class="controls" style="display: none;">
						<input type="text" class="input-xlarge" name="name">
					</div>
					<div class="control-group">
					<label class="control-label" for="category">What is this?</label>
					<div class="controls">
						<select name="reason">
							<option value="Отдых">Отдых</option>
                           <option value="Активный спорт">Активный спорт</option>
                          <option value="Посещ">Посещение достопримечательности</option>
                          <option value="Особ">Особое событий</option>
						</select>
					</div>
				</div>
					<label class="control-label" for="description">Description</label>
					<div class="controls">
						<textarea class="input-xlarge" name="comment" rows="3"></textarea>
				<div class="form-actions">
					<button type="submit" class="btn btn-primary">Save me</button>
				</div>
				

  </form>

</div>
<!--The div element for the map -->
<div id="map"></div>
<script>
  // This sample uses the Place Autocomplete widget to allow the user to search
  // for and select a place. The sample then displays an info window containing
  // the place ID and other information about the place that the user has
  // selected.

  // This example requires the Places library. Include the libraries=places
  // parameter when you first load the API. For example:
  // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">
  var map;
  var markers = {};
  var counter = -1;
  function initMap() {
  	var uluru = {lat: -25.363, lng: 131.044};
    var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 4,
    center: uluru
  });

    $(document).on('click', '[data-toggle="modal"]', function () {
  $.ajax({
    url: '#',
    type: 'POST',
    dataType: 'json',
    data: $(this).data('data')
  }).done(function(data) {
    for (var i = 0; i < data.length; i++) {
      var maker = new google.maps.Marker({
      	position: new google.maps.LatLng(data[i][3])
      });
      marker.addListener('dblclick', function() {
    infowindow.open(map, marker);
    infowindow.setContent(data[i][1] + data[i][2]);
    });
    }
  }).fail(function(error) {
    console.log(error);
  });
});


    var addMarker = google.maps.event.addListener(map, 'click', function(e) {

      var lat = e.latLng.lat(); // lat of clicked point
      var lng = e.latLng.lng(); // lng of clicked point
      var id = markers.length
      var marker = new google.maps.Marker({
        position: getLatLng(lat, lng),
        map: map,
        id: markers.length
      });
      map.panTo(getLatLng(lat, lng));
      markers[marker.id] = marker; // cache marker in markers object
      bindMarkerEvents(marker);




var form =	$(".save-form").clone().show();
		var infowindow_content = form[0];

		var infowindow = new google.maps.InfoWindow({
			content: infowindow_content
		});

 marker.addListener('dblclick', function() {
    infowindow.open(map, marker);
     $('body').on('submit', '#formId', function(e) {  
    event.preventDefault();		
    $("input").val(marker.position);
        var data = {
				comment: $("textarea[name=comment]", this).val(),
				reason: $("select[name=reason]",this).val(),
				position: $("input",this).val()
			};
			 $.ajax({

            type: 'POST', url: '#', data: data, dataType: 'json' ,success: function() {
          alert('did it');
        }});
			
			//send the results to the PHP script that adds the point to the database
 infowindow.setContent('done' + data.position + data.reason)
			return false;
			//Erase the form and replace with new messag
});
  });
 
 
  });
    
  }

  /**
   * Global marker object that holds all markers.
   * @type {Object.<string, google.maps.LatLng>}
   */
var getLatLng = function(lat, lng) {
    return new google.maps.LatLng(lat, lng);
};

 
  var bindMarkerEvents = function(marker) {
    google.maps.event.addListener(marker, "rightclick", function () {
      removeMarker(marker, marker.id); // remove it
      });
 };

  /**
   * Removes given marker from map.
   * @param {!google.maps.Marker} marker A google.maps.Marker instance that will be removed.
   * @param {!string} markerId Id of marker.
   */
  var removeMarker = function(marker, markerId) {
    marker.setMap(null); // set markers setMap to null to remove it from map
    markers.splice(markerId, 1); // delete marker instance from markers object
    
  };


</script>
<!--Load the API from the specified URL
* The async attribute allows the browser to render the page while the API loads
* The key parameter will contain your own API key (which is not needed for this tutorial)
* The callback parameter executes the initMap() function
-->
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBzFQHgq_oegPGqKBNe7uRx7OPmFZmnceU&callback=initMap"
        type="text/javascript"></script>
</body>
</html>
